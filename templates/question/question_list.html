<!-- question list with bootstrap -->

<!-- before inheritance base html
   <link rel="stylesheet" href="{{url_for('static', filename='bootstrap.min.css')}}">
-->

<!-- inheritance standard base html -->
{% extends 'base.html' %}
{% block content %}
<div class="container my-3">   
   <!-- search window start -->
   <div class="row my-3">
      <div class="col-6">
         <a href="{{url_for('question.create')}}" class="btn btn-primary">Insert Question</a>
      </div>
      <div class="col-6">
         <div class="input-group">
            <input type="text" id="search_kw" class="form-control" value="{{ kw or ''}}">
            <div class="input-group-append">
               <button class="btn btn-outline-secondary" type="button" id="btn_search">search</button>
            </div>
         </div>
      </div>
   </div>
   <!-- search window end -->
   <table class="table">
      <thead>
      <tr class="text-center table-dark">
         <th>number</th>
         <th style="width:50%">title</th>
         <th>username</th>
         <th>date</th>
      </tr>
      </thead>
      <tbody>
      {% if question_list %}
      <!-- question_list is pagination object parameter from question_view.py and return items-->
      {% for question in question_list.items %}
      <!-- sort text on center -->
      <tr class="text-center">
         <td>{{question_list.total - ((question_list.page - 1) * question_list.per_page) - loop.index0}}</td>
         <td class="text-start">
            <a href="{{url_for('question.detail', question_id=question.id)}}">{{question.subject}}</a>
            {% if question.answer_set | length > 0%}
            <!-- count number of answer -->
            <span class="text-danger small mx-2">[{{question.answer_set | length}}]</span>
            {% endif %}
         </td>
         <!-- question form question_list and relationship obj created from models.py -->
         <td>{{question.user.username}}</td>
         <td>{{question.create_date | datetime}}</td>
      </tr>
      {% endfor %}
      {% else %}
      <tr>
         <td colspan="4">not question.</td>
      </tr>
      {% endif %}
      </tbody>
   </table>
   <!-- pasing button bar start -->
   <ul class="pagination justify-content-center">
      <!-- before page -->
      {% if question_list.has_prev %}
      <li class="page-item">
         <!--<a class="page-link" href="?page={{question_list.prev_num}}">before</a>-->
         <a class="page-link" data-page="{{question_list.prev_num}}" href="javascript:void(0)">before</a>
      </li>
      {% else %}
      <li class="page-item disabled">
         <a class="page-link" tabindex="-1" aria-disabled="true" href="javascript:void(0)">before</a>
      </li>
      {% endif %}
      <!-- page number -->
      {% for page_num in question_list.iter_pages() %}
      {% if page_num %}
      {% if page_num != question_list.page %}
      <li class="page-item">
         <!--<a class="page-link" href="?page={{page_num}}">{{page_num}}</a>-->
         <a class="page-link" data-page="{{page_num}}" href="javascript:void(0)">{{page_num}}</a>
      </li>
      {% else %}
      <li class="page-item active" aria-current="page">
         <a class="page-link" href="#">{{page_num}}</a>
      </li>
      {% endif %}
      {% else %}
      <li class="disabled">
         <a class="page-link" href="javascript:void(0)">...</a>
      </li>
      {% endif %}
      {% endfor %}
      <!-- next page -->
      {% if question_list.has_next %}
      <li class="page-item">
         <!--<a class="page-link" href="?page={{question_list.next_num}}">next</a>-->
         <a class="page-link" data-page="{{question_list.next_num}}" href="javascript:void(0)">next</a>
      </li>
      {% else %}
      <li class="page-item disabled">
         <a class="page-link" tabindex="-1" aria-disabled="true" href="javascript:void(0)">next</a>
      </li>
      {% endif %}
   </ul>
   <!-- pasing button bar end -->
   <!-- origin insert question button, changed location = moved top
   <a href="{{url_for('question.create')}}" class="btn btn-primary">Insert Question</a>
   -->
   <!-- search keyword and page form -->
</div>
<form id="searchForm" method="get" action="{{url_for('question.qlist')}}">
   <input type="hidden" id="kw" name="kw" value="{{ kw or '' }}">
   <input type="hidden" id="page" name="page" value="{{ page }}">
</form>
{% endblock %}
<!-- search func javascript -->
{% block script %}
<script type='text/javascript'>
const page_elements = document.getElementsByClassName("page-link") ;
Array.from(page_elements).forEach(function(element) {
   element.addEventListener('click', function() {
      document.getElementById('page').value = this.dataset.page ;
      document.getElementById('searchForm').submit() ;
   }) ;
}) ;
const btn_search = document.getElementById("btn_search") ;
btn_search.addEventListener('click', function() {
      document.getElementById('kw').value = document.getElementById('search_kw').value ;
      document.getElementById('page').value = 1 ;
      document.getElementById('searchForm').submit() ; 
}) ;
</script>
{% endblock%}